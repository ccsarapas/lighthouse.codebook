<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a codebook object from REDCap data — cb_create_rc • lighthouse.codebook</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a codebook object from REDCap data — cb_create_rc"><meta name="description" content='cb_create_rc() builds an object of class "li_codebook" from a dataset and
corresponding codebook exported from REDCap. The resulting object can be used
to write an Excel workbook with variable and data summaries (using cb_write()),
extract processed data (cb_get_data()), or generate dataset summaries (cb_summarize_numeric()
and cb_summarize_categorical()).
This variant of cb_create() includes functionality specific to REDCap data
and metadata, including:
Defaults for typical REDCap metadata column names
Includes form field by default
Unpacking, labelling, and optional missing propagation for checkbox data
Optional coercion for character variables marked as "integer" in metedata$text_validation_type_or_show_slider_number

'><meta property="og:description" content='cb_create_rc() builds an object of class "li_codebook" from a dataset and
corresponding codebook exported from REDCap. The resulting object can be used
to write an Excel workbook with variable and data summaries (using cb_write()),
extract processed data (cb_get_data()), or generate dataset summaries (cb_summarize_numeric()
and cb_summarize_categorical()).
This variant of cb_create() includes functionality specific to REDCap data
and metadata, including:
Defaults for typical REDCap metadata column names
Includes form field by default
Unpacking, labelling, and optional missing propagation for checkbox data
Optional coercion for character variables marked as "integer" in metedata$text_validation_type_or_show_slider_number

'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lighthouse.codebook</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ccsarapas/lighthouse.codebook/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate a codebook object from REDCap data</h1>
      <small class="dont-index">Source: <a href="https://github.com/ccsarapas/lighthouse.codebook/blob/main/R/wrappers.r" class="external-link"><code>R/wrappers.r</code></a></small>
      <div class="d-none name"><code>cb_create_rc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>cb_create_rc()</code> builds an object of class <code>"li_codebook"</code> from a dataset and
corresponding codebook exported from REDCap. The resulting object can be used
to write an Excel workbook with variable and data summaries (using <code><a href="cb_write.html">cb_write()</a></code>),
extract processed data (<code><a href="cb_get_data.html">cb_get_data()</a></code>), or generate dataset summaries (<code><a href="cb_summarize_numeric.html">cb_summarize_numeric()</a></code>
and <code><a href="cb_summarize_categorical.html">cb_summarize_categorical()</a></code>).</p>
<p>This variant of <code>cb_create()</code> includes functionality specific to REDCap data
and metadata, including:</p><ul><li><p>Defaults for typical REDCap metadata column names</p></li>
<li><p>Includes form field by default</p></li>
<li><p>Unpacking, labelling, and optional missing propagation for checkbox data</p></li>
<li><p>Optional coercion for character variables marked as "integer" in <code>metedata$text_validation_type_or_show_slider_number</code></p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cb_create_rc</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">metadata</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .name <span class="op">=</span> <span class="va">field_name</span>,</span>
<span>  .var_label <span class="op">=</span> <span class="va">field_label</span>,</span>
<span>  .val_labels <span class="op">=</span> <span class="va">select_choices_or_calculations</span>,</span>
<span>  .form <span class="op">=</span> <span class="va">form_name</span>,</span>
<span>  .user_missing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .val_labs_sep1 <span class="op">=</span> <span class="st">", "</span>,</span>
<span>  .val_labs_sep2 <span class="op">=</span> <span class="st">"\\|"</span>,</span>
<span>  .rmv_html <span class="op">=</span> <span class="op">!</span><span class="va">name</span>,</span>
<span>  .rmv_line_breaks <span class="op">=</span> <span class="op">!</span><span class="va">name</span>,</span>
<span>  .coerce_integers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .checkbox_resp_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .propagate_checkbox_missings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .separate_missings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"if_any"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span>,</span>
<span>  .user_missing_conflict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"metadata"</span>, <span class="st">"missing_label"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame exported or retrieved from REDCap.</p></dd>


<dt id="arg-metadata">metadata<a class="anchor" aria-label="anchor" href="#arg-metadata"></a></dt>
<dd><p>A data frame containing the REDCap codebook associated with <code>data</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional columns from <code>metadata</code> to preserve in the final codebook.
New names can be assigned by passing named arguments. Columns for variable
name, form, variable label, and value labels are included by default.</p></dd>


<dt id="arg--name-var-label-val-labels">.name, .var_label, .val_labels<a class="anchor" aria-label="anchor" href="#arg--name-var-label-val-labels"></a></dt>
<dd><p>Columns in <code>metadata</code> containing variable
name, variable label, and value labels, respectively.</p></dd>


<dt id="arg--form">.form<a class="anchor" aria-label="anchor" href="#arg--form"></a></dt>
<dd><p>Column in <code>metadata</code> containing form names. (Set to <code>NULL</code> to omit.)</p></dd>


<dt id="arg--user-missing">.user_missing<a class="anchor" aria-label="anchor" href="#arg--user-missing"></a></dt>
<dd><p>A formula or list of formulas specifying user missing values.
Formulas should specify variables on the left-hand side (as variable names
or <a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidyselect</a> expressions), and missing values on the
right-hand side. See "Specifying user missing values" below for examples.</p></dd>


<dt id="arg--val-labs-sep-val-labs-sep-">.val_labs_sep1, .val_labs_sep2<a class="anchor" aria-label="anchor" href="#arg--val-labs-sep-val-labs-sep-"></a></dt>
<dd><p>Regex patterns separating value labels
in <code>metadata</code>. e.g., if value labels are in format <code>"1, First label|2, Second label"</code>,
set <code>.val_labs_sep1</code> to <code>","</code> and <code>.val_labs_sep2</code> to <code>"\\|"</code>.</p></dd>


<dt id="arg--rmv-html">.rmv_html<a class="anchor" aria-label="anchor" href="#arg--rmv-html"></a></dt>
<dd><p>&lt;<code><a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidy-select</a></code>&gt; Codebook columns from which
HTML tags should be removed.</p></dd>


<dt id="arg--rmv-line-breaks">.rmv_line_breaks<a class="anchor" aria-label="anchor" href="#arg--rmv-line-breaks"></a></dt>
<dd><p>&lt;<code><a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidy-select</a></code>&gt; Codebook columns
from which line breaks should be removed.</p></dd>


<dt id="arg--coerce-integers">.coerce_integers<a class="anchor" aria-label="anchor" href="#arg--coerce-integers"></a></dt>
<dd><p>Should variables listed as "integer" in <code>metedata$text_validation_type_or_show_slider_number</code>
be coerced to integer?</p></dd>


<dt id="arg--checkbox-resp-values">.checkbox_resp_values<a class="anchor" aria-label="anchor" href="#arg--checkbox-resp-values"></a></dt>
<dd><p>Should checkbox values use labels in <code>metadata</code>
(<code>TRUE</code>) or "Yes" / "No" (<code>FALSE</code>)? See "Checkbox data handling" below.</p></dd>


<dt id="arg--propagate-checkbox-missings">.propagate_checkbox_missings<a class="anchor" aria-label="anchor" href="#arg--propagate-checkbox-missings"></a></dt>
<dd><p>Should user missing values in a checkbox
group be propagated across all variables in the group? See "Checkbox data handling"
below.</p></dd>


<dt id="arg--separate-missings">.separate_missings<a class="anchor" aria-label="anchor" href="#arg--separate-missings"></a></dt>
<dd><p>Include value labels for user missing values in a separate
column? The default, <code>"if_any"</code>, adds the column only if user missings are
specified for at least one variable.</p></dd>


<dt id="arg--user-missing-conflict">.user_missing_conflict<a class="anchor" aria-label="anchor" href="#arg--user-missing-conflict"></a></dt>
<dd><p>If different labels for a value are provided in
metadata and user missings, which should be used?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>"li_codebook"</code> object, consisting of (1) a tibble summarizing the passed
dataset and (2) attributes containing the passed dataset (in several formats)
and additional metadata. Specifically:</p><ul><li><p>A tibble with columns:</p><ul><li><p><code>name</code>: variable name</p></li>
<li><p><code>form</code>: form name</p></li>
<li><p><code>type</code>: variable type</p></li>
<li><p><code>label</code>: variable label</p></li>
<li><p><code>value_labels</code>: value labels</p></li>
<li><p><code>user_missing</code>: optional column, depending on value of <code>.separate_missings</code>,
with value labels for user missing values</p></li>
<li><p><code>missing</code>: proportion missing</p></li>
<li><p>additional columns if specified in <code>...</code></p></li>
</ul></li>
<li><p>Attributes:</p><ul><li><p>Transformed versions of the passed dataset. See <code><a href="cb_get_data.html">cb_get_data()</a></code>.</p></li>
<li><p>Lookup tables and other metadata used internally: <code>"user_missing"</code>, <code>"vals_by_label"</code>,
<code>"labs_by_value"</code>, <code>"miss_propagate"</code>, <code>"factors"</code>, <code>"n_obs"</code>, <code>"n_vars"</code></p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="specifying-user-missing-values">Specifying user missing values<a class="anchor" aria-label="anchor" href="#specifying-user-missing-values"></a></h2>


<p>User missing values are defined by passing a formula or list of formulas to the
<code>.user_missing</code> argument. Formulas should specify variables on the left-hand
side and user missing values for those variables on the right-hand side:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">cb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cb_create_rc.html">cb_create_rc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">metadata</span>, .user_missing <span class="op">=</span> <span class="va">var1</span> <span class="op">~</span> <span class="fl">99</span><span class="op">)</span></span></code></pre></div><p>The same user missings can be applied to multiple variables using
<a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidyselect</a> expressions:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="co"># for variables `var1` through `var5`</span></span>
<span><span class="va">.user_missing</span> <span class="op">=</span> <span class="va">var1</span><span class="op">:</span><span class="va">var5</span> <span class="op">~</span> <span class="fl">99</span></span>
<span></span>
<span><span class="co"># for all numeric variables, plus `var6` and `var7`</span></span>
<span><span class="va">.user_missing</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">var6</span>, <span class="va">var7</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for all variables</span></span>
<span><span class="va">.user_missing</span> <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div><p>Different user missings can be applied to different variables using a list of
formulas:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">.user_missing</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">starts_with</span><span class="op">(</span><span class="st">"status"</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">98</span>, <span class="fl">99</span><span class="op">)</span>,</span>
<span>  <span class="va">var7</span><span class="op">:</span><span class="va">var10</span> <span class="op">~</span> <span class="fl">97</span></span>
<span><span class="op">)</span></span></code></pre></div><p>User missing values may optionally be named to set value labels:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">.user_missing</span> <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span> <span class="op">~</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Declined <span class="op">=</span> <span class="op">-</span><span class="fl">97</span>, <span class="st">"Don't know"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">98</span>, <span class="st">"Not applicable"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">99</span><span class="op">)</span></span></code></pre></div><p>If labels set in <code>.user_missing</code> conflict with those in <code>metadata</code>, <code>.user_missing_conflict</code>
controls which labels are used.</p>
    </div>
    <div class="section level2">
    <h2 id="checkbox-data-handling">Checkbox data handling<a class="anchor" aria-label="anchor" href="#checkbox-data-handling"></a></h2>


<div class="section">
<h3 id="value-labels">Value labels<a class="anchor" aria-label="anchor" href="#value-labels"></a></h3>


<p>Data from REDCap checkboxes yields one variable in the dataset for each response
option. These will be labelled generically with <code>"Yes"</code> or <code>"No"</code>, unless <code>.checkbox_resp_values</code>
is <code>TRUE</code>, in which case response-specific labels from <code>metadata</code> will be used.
For example, if a checkbox group has options "In the past year," "More than a
year ago," and "Never," corresponding to variables <code>chk_var1___0</code>, <code>chk_var1___1</code>,
and <code>chk_var1___2</code>: if <code>.checkbox_resp_values</code> is <code>FALSE</code>, all of these will
have values "[0] No; [1] Yes." If <code>.checkbox_resp_values</code> is <code>TRUE</code>, each variable:
will have unique labels:</p><ul><li><p><code>chk_var1___0</code>: "[0] Not selected [1] In the past year"</p></li>
<li><p><code>chk_var1___1</code>: "[0] Not selected [1] More than a year ago"</p></li>
<li><p><code>chk_var1___2</code>: "[0] Not selected [1] Never"</p></li>
</ul></div>

<div class="section">
<h3 id="missing-value-propagation">Missing value propagation<a class="anchor" aria-label="anchor" href="#missing-value-propagation"></a></h3>


<p>If <code>.propagate_checkbox_missings</code> is <code>TRUE</code>, missing values in a checkbox group
variable will be propagated to all variables in the group. For example, given
a checkbox group with options "Pregnant," "Not pregnant," and "Not applicable,"
corresponding to variables <code>chk_preg_0___0</code>, <code>chk_preg_0___1</code>, and <code>chk_preg_0____9</code>,
and assuming that <code>-9</code> is specified as a user missing value. If <code>.propagate_checkbox_missings</code>
is <code>TRUE</code>, <code>chk_preg_0___0</code> and <code>chk_preg_0___1</code> will be set to <code>-9</code> if <code>chk_preg_0____9</code>
is <code>1</code>. Otherwise, these columns will remain as <code>0</code> where <code>chk_preg_0____9</code> is <code>1</code>.</p>
<p>[0]: R:0%5C
[1]: R:1%5C
[0]: R:0
[1]: R:1
[0]: R:0
[1]: R:1
[0]: R:0
[1]: R:1</p>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>lighthouse.codebook</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

